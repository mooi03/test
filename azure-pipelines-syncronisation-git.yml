trigger:
  branches:
    include:
      - main

pool:
  name: 'default'

steps:
- checkout: self
  persistCredentials: true

- script: |
    git remote add azure "https://dev.azure.com/tlonchampt/armand/_git/armand"
    
    git fetch azure
    git branch -r | grep -v '\->' | sed 's/origin\///' | while read branch; do
        git push azure --delete "$branch" || true 
    done

    git checkout main
    git pull origin main  

    git push azure main:main --force
  displayName: "Supprimer tout le dépôt Azure DevOps et copier depuis GitHub"
