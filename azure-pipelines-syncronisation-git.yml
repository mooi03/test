trigger:
  branches:
    include:
      - main

pool:
  name: 'default'

steps:
- checkout: self
  persistCredentials: true

- script: |
    git remote add azure "https://dev.azure.com/tlonchampt/armand/_git/armand"
    git fetch azure

    git branch -r | grep -v '\->' | sed 's/origin\///' | while read branch; do
        git push azure --delete "$branch" || true 
    done

  displayName: "Supprimer toutes les branches du dépôt Azure DevOps"
